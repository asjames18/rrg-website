<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>RRG Admin</title>
    <link rel="icon" href="/rrg-logo.jpg" type="image/jpeg" />
    <style>
      body { 
        background:#000; 
        color:#f5f5f5; 
        font-family: system-ui, -apple-system, sans-serif;
      }
      .nc-app-header-content h1 { 
        font-family: Cinzel, ui-serif, serif; 
        color:#d4af37; 
      }
      /* Passcode gate overlay */
      #gate {
        position: fixed;
        inset: 0;
        background: #000;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }
      #gate-form {
        background: #1a1a1a;
        border: 1px solid #d4af37;
        border-radius: 8px;
        padding: 2rem;
        max-width: 400px;
        width: 90%;
      }
      #gate h2 {
        color: #d4af37;
        margin: 0 0 1rem 0;
        font-size: 1.5rem;
      }
      #gate input {
        width: 100%;
        padding: 0.75rem;
        background: #000;
        border: 1px solid #444;
        border-radius: 4px;
        color: #f5f5f5;
        font-size: 1rem;
        margin-bottom: 1rem;
      }
      #gate input:focus {
        outline: none;
        border-color: #d4af37;
      }
      #gate button {
        width: 100%;
        padding: 0.75rem;
        background: #d4af37;
        color: #000;
        border: none;
        border-radius: 4px;
        font-weight: 600;
        cursor: pointer;
        font-size: 1rem;
      }
      #gate button:hover {
        background: #c69c6d;
      }
      #gate .error {
        color: #c62828;
        font-size: 0.875rem;
        margin-top: 0.5rem;
      }
      #gate .hint {
        color: #888;
        font-size: 0.75rem;
        margin-top: 1rem;
      }
    </style>
  </head>
  <body>
    <!-- Passcode gate (client-side only - not real security) -->
    <div id="gate">
      <div id="gate-form">
        <h2>RRG Admin Access</h2>
        <input 
          type="password" 
          id="passcode" 
          placeholder="Enter passcode"
          autocomplete="off"
        />
        <button onclick="checkPasscode()">Access Admin</button>
        <div id="error" class="error"></div>
        <div class="hint">
          Note: After passcode, GitHub authentication is required to edit content.
        </div>
      </div>
    </div>

    <!-- Decap CMS bundle (loaded after gate check) -->
    <script>
      // Passcode gate - minimal client-side check
      // Real security is via GitHub OAuth in Decap CMS
      
      const STORAGE_KEY = 'rrg_admin_ok';
      
          // Passcode - change this before production!
          // For production: replace 'rrg-dev' with your secure passcode
          // In production, this should be injected from environment variables
          const PASSCODE = 'rrg-dev'; // TODO: Use environment variable in production
      
      // Check if already authenticated
      if (localStorage.getItem(STORAGE_KEY) === '1') {
        removeGate();
        loadCMS();
      }
      
      // Allow Enter key
      document.getElementById('passcode')?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') checkPasscode();
      });
      
      function checkPasscode() {
        const input = document.getElementById('passcode');
        const error = document.getElementById('error');
        
        if (input.value === PASSCODE) {
          // Correct passcode
          localStorage.setItem(STORAGE_KEY, '1');
          error.textContent = '';
          removeGate();
          loadCMS();
        } else {
          // Wrong passcode - redirect after showing error
          error.textContent = 'Incorrect passcode. Redirecting...';
          setTimeout(() => {
            window.location.href = '/';
          }, 1500);
        }
      }
      
      function removeGate() {
        const gate = document.getElementById('gate');
        if (gate) gate.style.display = 'none';
      }
      
      function loadCMS() {
        // Load Decap CMS
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js';
        document.body.appendChild(script);
      }
    </script>
  </body>
</html>

