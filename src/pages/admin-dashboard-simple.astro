---
/**
 * Simple Admin Dashboard (No React Components)
 * Visit: http://localhost:4321/admin-dashboard-simple
 */
export const prerender = false;

import Base from '../layouts/Base.astro';
import { supabaseServer } from '../lib/supabase-server';

// Get content stats (with error handling)
let postsCount = 0;
let videosCount = 0;
let booksCount = 0;
let musicCount = 0;
let usersCount = 0;

try {
  const { count: posts } = await supabaseServer
    .from('posts')
    .select('*', { count: 'exact', head: true });
  postsCount = posts || 0;
} catch (error) {
  console.log('Posts table not found, using default count');
}

try {
  const { count: videos } = await supabaseServer
    .from('videos')
    .select('*', { count: 'exact', head: true });
  videosCount = videos || 0;
} catch (error) {
  console.log('Videos table not found, using default count');
}

try {
  const { count: books } = await supabaseServer
    .from('books')
    .select('*', { count: 'exact', head: true });
  booksCount = books || 0;
} catch (error) {
  console.log('Books table not found, using default count');
}

try {
  const { count: music } = await supabaseServer
    .from('music')
    .select('*', { count: 'exact', head: true });
  musicCount = music || 0;
} catch (error) {
  console.log('Music table not found, using default count');
}

try {
  const { count: users } = await supabaseServer
    .from('profiles')
    .select('*', { count: 'exact', head: true });
  usersCount = users || 0;
} catch (error) {
  console.log('Profiles table not found, using default count');
}
---

<Base title="Admin Dashboard | Real & Raw Gospel">
  <div class="container mx-auto px-4 py-12 md:py-16">
    <div class="max-w-6xl mx-auto">
      <div class="mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-amber-100 mb-4">
          Admin Dashboard
        </h1>
        <p class="text-lg text-neutral-300">
          Manage content, users, and site settings
        </p>
      </div>

      <!-- Stats Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-5 gap-6 mb-12">
        <div class="bg-neutral-900 border border-neutral-800 rounded-lg p-6">
          <div class="text-2xl font-bold text-amber-100">{postsCount}</div>
          <div class="text-sm text-neutral-400">Blog Posts</div>
        </div>
        <div class="bg-neutral-900 border border-neutral-800 rounded-lg p-6">
          <div class="text-2xl font-bold text-amber-100">{videosCount}</div>
          <div class="text-sm text-neutral-400">Videos</div>
        </div>
        <div class="bg-neutral-900 border border-neutral-800 rounded-lg p-6">
          <div class="text-2xl font-bold text-amber-100">{booksCount}</div>
          <div class="text-sm text-neutral-400">Books</div>
        </div>
        <div class="bg-neutral-900 border border-neutral-800 rounded-lg p-6">
          <div class="text-2xl font-bold text-amber-100">{musicCount}</div>
          <div class="text-sm text-neutral-400">Music</div>
        </div>
        <div class="bg-neutral-900 border border-neutral-800 rounded-lg p-6">
          <div class="text-2xl font-bold text-amber-100">{usersCount}</div>
          <div class="text-sm text-neutral-400">Users</div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
        <a 
          href="/admin" 
          class="bg-amber-700 hover:bg-amber-600 text-white font-semibold py-6 px-6 rounded-lg text-center transition-colors focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 focus:ring-offset-black"
        >
          <div class="text-xl mb-2">üìù</div>
          <div class="font-bold">Content Management</div>
          <div class="text-sm opacity-90">Edit posts, videos, books</div>
        </a>

        <a 
          href="/test-database" 
          class="bg-neutral-800 hover:bg-neutral-700 text-neutral-200 font-semibold py-6 px-6 rounded-lg text-center transition-colors focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 focus:ring-offset-black"
        >
          <div class="text-xl mb-2">üóÑÔ∏è</div>
          <div class="font-bold">Database</div>
          <div class="text-sm opacity-90">View and test data</div>
        </a>

        <a 
          href="/api/test-supabase" 
          class="bg-blue-700 hover:bg-blue-600 text-white font-semibold py-6 px-6 rounded-lg text-center transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-black"
        >
          <div class="text-xl mb-2">üîó</div>
          <div class="font-bold">API Test</div>
          <div class="text-sm opacity-90">Check Supabase connection</div>
        </a>
      </div>

      <!-- Recent Activity -->
      <div class="bg-neutral-900 border border-neutral-800 rounded-lg p-6">
        <h2 class="text-xl font-bold text-amber-100 mb-4">Recent Activity</h2>
        <div class="space-y-3">
          <div class="flex items-center gap-3 text-sm text-neutral-300">
            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
            <span>Supabase connection established</span>
            <span class="text-neutral-500 ml-auto">Just now</span>
          </div>
          <div class="flex items-center gap-3 text-sm text-neutral-300">
            <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
            <span>Admin dashboard loaded</span>
            <span class="text-neutral-500 ml-auto">Just now</span>
          </div>
          <div class="flex items-center gap-3 text-sm text-neutral-300">
            <span class="w-2 h-2 bg-amber-500 rounded-full"></span>
            <span>Content collections configured</span>
            <span class="text-neutral-500 ml-auto">Recently</span>
          </div>
        </div>
      </div>

      <!-- User Management Section -->
      <div class="mt-8 bg-neutral-900 border border-neutral-800 rounded-lg p-6">
        <h3 class="text-xl font-bold text-amber-100 mb-4">User Management</h3>
        <div class="space-y-4">
          <div class="bg-neutral-800 border border-neutral-700 rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-neutral-200 font-medium">User Management Tools</div>
                <div class="text-sm text-neutral-400">Manage user roles and permissions</div>
              </div>
              <div class="space-x-2">
                <a 
                  href="/admin-promote" 
                  class="bg-red-700 hover:bg-red-600 text-white px-3 py-1.5 rounded text-sm transition-colors"
                >
                  Promote User
                </a>
                <a 
                  href="/admin-login" 
                  class="bg-blue-700 hover:bg-blue-600 text-white px-3 py-1.5 rounded text-sm transition-colors"
                >
                  Admin Login
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Links -->
      <div class="mt-8 grid md:grid-cols-2 lg:grid-cols-4 gap-4">
        <a 
          href="/admin-test" 
          class="bg-neutral-800 hover:bg-neutral-700 text-neutral-200 font-semibold py-3 px-4 rounded-lg text-center transition-colors text-sm"
        >
          Admin Test Page
        </a>
        <a 
          href="/debug-api" 
          class="bg-neutral-800 hover:bg-neutral-700 text-neutral-200 font-semibold py-3 px-4 rounded-lg text-center transition-colors text-sm"
        >
          Debug API
        </a>
        <a 
          href="/profile" 
          class="bg-neutral-800 hover:bg-neutral-700 text-neutral-200 font-semibold py-3 px-4 rounded-lg text-center transition-colors text-sm"
        >
          User Profile
        </a>
        <a 
          href="/auth" 
          class="bg-neutral-800 hover:bg-neutral-700 text-neutral-200 font-semibold py-3 px-4 rounded-lg text-center transition-colors text-sm"
        >
          Authentication
        </a>
      </div>
    </div>
  </div>
</Base>
